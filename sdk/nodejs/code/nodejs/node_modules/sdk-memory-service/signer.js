const log = require('lambda-log');
var cfsign = require('aws-cloudfront-sign');

class Signer {
  constructor(url,keyPairId,pemPath,durationSeconds) {
    this.url = url;
    this.keyPairId=keyPairId;
    this.pemPath=pemPath;
    this.durationSeconds=durationSeconds;
  };

    generateSignedURL() {
        var signingParams = {
        keypairId: this.keyPairId,
        privateKeyString: process.env.PRIVATE_KEY,
        privateKeyPath: this.pemPath,  
        expireTime: new Date().getTime() + (this.durationSeconds * 1000)
        }
        var signedUrl = cfsign.getSignedUrl(this.url, signingParams);
        log.debug("signedUrl: " + signedUrl);
        return signedUrl;
    }

}
    
module.exports = Signer;    